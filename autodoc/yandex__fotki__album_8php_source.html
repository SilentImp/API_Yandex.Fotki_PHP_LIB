<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>yandex.fotki: Исходный файл Yandex/yandex/yandex_fotki_album.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Создано системой Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Поиск');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Титульная&nbsp;страница</span></a></li>
      <li><a href="pages.html"><span>Описания</span></a></li>
      <li><a href="modules.html"><span>Группы</span></a></li>
      <li><a href="annotated.html"><span>Структуры&nbsp;данных</span></a></li>
      <li class="current"><a href="files.html"><span>Файлы</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Поиск" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Файлы</span></a></li>
    </ul>
  </div>
<h1>Yandex/yandex/yandex_fotki_album.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00003"></a>00003 
<a name="l00010"></a><a class="code" href="classyandex__fotki__album.html">00010</a>         <span class="keyword">class </span><a class="code" href="classyandex__fotki__album.html" title="Класс, который позволяет вам работать с альбомом...">yandex_fotki_album</a>{
<a name="l00012"></a>00012                 <span class="keyword">private</span> $id = null;
<a name="l00014"></a>00014                 <span class="keyword">private</span> $author = null;
<a name="l00016"></a>00016                 <span class="keyword">private</span> $title = null;
<a name="l00018"></a>00018                 <span class="keyword">private</span> $summary = null;
<a name="l00020"></a>00020                 <span class="keyword">private</span> $self_url = null;
<a name="l00022"></a>00022                 <span class="keyword">private</span> $edit_url = null;
<a name="l00024"></a>00024                 <span class="keyword">private</span> $photos_url = null;
<a name="l00026"></a>00026                 <span class="keyword">private</span> $ymapsml_url = null;
<a name="l00028"></a>00028                 <span class="keyword">private</span> $alternate_url = null;
<a name="l00030"></a>00030                 <span class="keyword">private</span> $published_date = null;
<a name="l00032"></a>00032                 <span class="keyword">private</span> $edited_date = null;
<a name="l00034"></a>00034                 <span class="keyword">private</span> $updated_date = null;
<a name="l00036"></a>00036                 <span class="keyword">private</span> $protected = <span class="keyword">false</span>;
<a name="l00038"></a>00038                 <span class="keyword">private</span> $image_count = null;
<a name="l00040"></a>00040                 <span class="keyword">private</span> $xml = null;
<a name="l00042"></a>00042                 <span class="keyword">private</span> $token=null;
<a name="l00044"></a>00044                 <span class="keyword">private</span> $dead = <span class="keyword">false</span>;
<a name="l00046"></a>00046                 <span class="keyword">private</span> $photo_collection = array();
<a name="l00047"></a>00047                 
<a name="l00049"></a>00049 
<a name="l00052"></a><a class="code" href="classyandex__fotki__album.html#a8a94003b9d888b085c68d6eac44be175">00052</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a8a94003b9d888b085c68d6eac44be175" title="Возвращает идентификатор Atom Entry альбома.">get_id</a>(){
<a name="l00053"></a>00053                         <span class="keywordflow">return</span> $this-&gt;id;
<a name="l00054"></a>00054                 }
<a name="l00055"></a>00055                 
<a name="l00057"></a>00057 
<a name="l00060"></a><a class="code" href="classyandex__fotki__album.html#a85e8dbce2eb4cccb9d6810d433186422">00060</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a85e8dbce2eb4cccb9d6810d433186422" title="Возвращает информацию о владельце альбома.">get_author</a>(){
<a name="l00061"></a>00061                         <span class="keywordflow">return</span> $this-&gt;author;
<a name="l00062"></a>00062                 }
<a name="l00063"></a>00063 
<a name="l00065"></a>00065 
<a name="l00068"></a><a class="code" href="classyandex__fotki__album.html#a3d601c20573b7f46ed6d2f06a3651bc4">00068</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a3d601c20573b7f46ed6d2f06a3651bc4" title="Возвращает описание альбома.">get_summary</a>(){
<a name="l00069"></a>00069                         <span class="keywordflow">return</span> $this-&gt;summary;
<a name="l00070"></a>00070                 }
<a name="l00071"></a>00071                 
<a name="l00073"></a>00073 
<a name="l00076"></a><a class="code" href="classyandex__fotki__album.html#ac01f0421cdf853d8bdac45fcd181dc28">00076</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#ac01f0421cdf853d8bdac45fcd181dc28" title="Возвращает название альбома.">get_title</a>(){
<a name="l00077"></a>00077                         <span class="keywordflow">return</span> $this-&gt;title;
<a name="l00078"></a>00078                 }
<a name="l00079"></a>00079                 
<a name="l00081"></a>00081 
<a name="l00084"></a><a class="code" href="classyandex__fotki__album.html#a852e12a65a6cc76db3f51d83e6f7f765">00084</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a852e12a65a6cc76db3f51d83e6f7f765" title="Возвращает название альбома.">get_self_url</a>(){
<a name="l00085"></a>00085                         <span class="keywordflow">return</span> $this-&gt;self_url;
<a name="l00086"></a>00086                 }
<a name="l00087"></a>00087                 
<a name="l00089"></a>00089 
<a name="l00092"></a><a class="code" href="classyandex__fotki__album.html#acb8a0fa5697303e3bae453619ac02a0e">00092</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#acb8a0fa5697303e3bae453619ac02a0e" title="Возвращает название альбома.">get_edit_url</a>(){
<a name="l00093"></a>00093                         <span class="keywordflow">return</span> $this-&gt;edit_url;
<a name="l00094"></a>00094                 }
<a name="l00095"></a>00095                 
<a name="l00097"></a>00097 
<a name="l00100"></a><a class="code" href="classyandex__fotki__album.html#a76025dc847e579904a40b1bb9ff872cc">00100</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a76025dc847e579904a40b1bb9ff872cc" title="Возвращает название альбома.">get_photos_url</a>(){
<a name="l00101"></a>00101                         <span class="keywordflow">return</span> $this-&gt;photos_url;
<a name="l00102"></a>00102                 }
<a name="l00103"></a>00103                 
<a name="l00105"></a>00105 
<a name="l00108"></a><a class="code" href="classyandex__fotki__album.html#aa26231576797c0dc7d36d9f01924b09f">00108</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#aa26231576797c0dc7d36d9f01924b09f" title="Возвращает название альбома.">get_ymapsml_url</a>(){
<a name="l00109"></a>00109                         <span class="keywordflow">return</span> $this-&gt;ymapsml_url;
<a name="l00110"></a>00110                 }
<a name="l00111"></a>00111                 
<a name="l00113"></a>00113 
<a name="l00116"></a><a class="code" href="classyandex__fotki__album.html#a50d598d3c86c3300c2a2212cdfef1c8e">00116</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a50d598d3c86c3300c2a2212cdfef1c8e" title="Возвращает название альбома.">get_alternate_url</a>(){
<a name="l00117"></a>00117                         <span class="keywordflow">return</span> $this-&gt;alternate_url;
<a name="l00118"></a>00118                 }
<a name="l00119"></a>00119                 
<a name="l00121"></a>00121 
<a name="l00124"></a><a class="code" href="classyandex__fotki__album.html#a3de873b569ef300cd78c68997c849deb">00124</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a3de873b569ef300cd78c68997c849deb" title="Возвращает название альбома.">get_published_date</a>(){
<a name="l00125"></a>00125                         <span class="keywordflow">return</span> $this-&gt;published_date;
<a name="l00126"></a>00126                 }
<a name="l00127"></a>00127                 
<a name="l00129"></a>00129 
<a name="l00132"></a><a class="code" href="classyandex__fotki__album.html#abac936830931ef9e66ea2990d6ceeb87">00132</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#abac936830931ef9e66ea2990d6ceeb87" title="Возвращает название альбома.">get_edited_date</a>(){
<a name="l00133"></a>00133                         <span class="keywordflow">return</span> $this-&gt;edited_date;
<a name="l00134"></a>00134                 }
<a name="l00135"></a>00135                 
<a name="l00137"></a>00137 
<a name="l00140"></a><a class="code" href="classyandex__fotki__album.html#a6a6b5228894cddc11e7c323b0b68e631">00140</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a6a6b5228894cddc11e7c323b0b68e631" title="Возвращает название альбома.">get_updated_date</a>(){
<a name="l00141"></a>00141                         <span class="keywordflow">return</span> $this-&gt;updated_date;
<a name="l00142"></a>00142                 }
<a name="l00143"></a>00143                 
<a name="l00145"></a>00145 
<a name="l00148"></a><a class="code" href="classyandex__fotki__album.html#a2f98779f3b058d113399c0e10fe43b77">00148</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a2f98779f3b058d113399c0e10fe43b77" title="Возвращает название альбома.">get_protected</a>(){
<a name="l00149"></a>00149                         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">protected</span>;
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151                 
<a name="l00153"></a>00153 
<a name="l00156"></a><a class="code" href="classyandex__fotki__album.html#ac04abb3c035eb6a78d2555ba7038b364">00156</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#ac04abb3c035eb6a78d2555ba7038b364" title="Возвращает название альбома.">get_image_count</a>(){
<a name="l00157"></a>00157                         <span class="keywordflow">return</span> $this-&gt;image_count;
<a name="l00158"></a>00158                 }
<a name="l00159"></a>00159                 
<a name="l00161"></a>00161 
<a name="l00164"></a><a class="code" href="classyandex__fotki__album.html#a4a213f466f0f17054814c5600672f0d0">00164</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a4a213f466f0f17054814c5600672f0d0" title="Возвращает название альбома.">get_xml</a>(){
<a name="l00165"></a>00165                         <span class="keywordflow">return</span> $this-&gt;xml;
<a name="l00166"></a>00166                 }
<a name="l00167"></a>00167                 
<a name="l00169"></a>00169 
<a name="l00172"></a><a class="code" href="classyandex__fotki__album.html#ac49943f42402ca0b92a8acfcbf241b7c">00172</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#ac49943f42402ca0b92a8acfcbf241b7c" title="Проверяет был ли альбом удален.">is_dead</a>(){
<a name="l00173"></a>00173                         <span class="keywordflow">return</span> $this-&gt;dead;     
<a name="l00174"></a>00174                 }
<a name="l00175"></a>00175                 
<a name="l00177"></a>00177 
<a name="l00181"></a><a class="code" href="classyandex__fotki__album.html#a9f27b603f4eee8bfebf08b8579cdc981">00181</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a9f27b603f4eee8bfebf08b8579cdc981" title="Конструктор альбома.">__construct</a>($xml=null,$token=null){
<a name="l00182"></a>00182                         $this-&gt;token = $token;
<a name="l00183"></a>00183                         $this-&gt;reload_xml($xml);
<a name="l00184"></a>00184                 }
<a name="l00185"></a>00185                 
<a name="l00187"></a>00187 
<a name="l00190"></a><a class="code" href="classyandex__fotki__album.html#a30861496bd09ceef919833fe7d90433f">00190</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a30861496bd09ceef919833fe7d90433f" title="Добавляет коллекцию фотографий с выбранным...">add_photo_collection</a>($collection_name=null){
<a name="l00191"></a>00191                         <span class="keywordflow">if</span>($collection_name===null){
<a name="l00192"></a>00192                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Не выбрано имя коллекции&quot;</span>,E_ERROR);
<a name="l00193"></a>00193                         }
<a name="l00194"></a>00194                         $this-&gt;photo_collection[$collection_name] = <span class="keyword">new</span> <a class="code" href="classyandex__fotki__photo__collection.html" title="Класс, который позволяет вам работать с коллекцией...">yandex_fotki_photo_collection</a>($this-&gt;photos_url,$this-&gt;token);
<a name="l00195"></a>00195                         $this-&gt;photo_collection[$collection_name]-&gt;search($this-&gt;token);
<a name="l00196"></a>00196                 }
<a name="l00197"></a>00197                 
<a name="l00199"></a><a class="code" href="classyandex__fotki__album.html#a2aff0844db6d9b56e6ba96123e1dd11c">00199</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a2aff0844db6d9b56e6ba96123e1dd11c" title="Обновляет данные текущего альбома.">refresh</a>(){
<a name="l00200"></a>00200                         $curl = curl_init();
<a name="l00201"></a>00201                         curl_setopt($curl, CURLOPT_URL, $this-&gt;edit_url);
<a name="l00202"></a>00202                         curl_setopt($curl, CURLOPT_HEADER, <span class="keyword">false</span>);
<a name="l00203"></a>00203                         curl_setopt($curl, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);
<a name="l00204"></a>00204                         curl_setopt($curl, CURLOPT_HTTPGET, <span class="keyword">true</span>);
<a name="l00205"></a>00205                         curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);
<a name="l00206"></a>00206                         <span class="keywordflow">if</span>($this-&gt;token!=null){
<a name="l00207"></a>00207                                 curl_setopt($curl, CURLOPT_HTTPHEADER,array(
<a name="l00208"></a>00208                                         <span class="stringliteral">&#39;Authorization: FimpToken realm=&quot;fotki.yandex.ru&quot;, token=&quot;&#39;</span>.$this-&gt;token.<span class="charliteral">&#39;&quot;&#39;</span>
<a name="l00209"></a>00209                                 ));
<a name="l00210"></a>00210                         }                       
<a name="l00211"></a>00211                         $response = curl_exec($curl);
<a name="l00212"></a>00212                         <span class="keywordflow">if</span>(curl_getinfo($curl,CURLINFO_HTTP_CODE)!=200){
<a name="l00213"></a>00213                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($response,E_ERROR);
<a name="l00214"></a>00214                         }
<a name="l00215"></a>00215                         curl_close($curl);
<a name="l00216"></a>00216                         $this-&gt;reload_xml($this-&gt;delete_ns($response));
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218                 
<a name="l00220"></a>00220 
<a name="l00226"></a><a class="code" href="classyandex__fotki__album.html#a1a6d2e6208bc1c225bf2f74604ae9de0">00226</a>                 <span class="keyword">public</span> function <a class="code" href="classyandex__fotki__album.html#a1a6d2e6208bc1c225bf2f74604ae9de0" title="Редактирует данные альбома.">edit</a>($title=null,$summary=null,$password=null,$token=null){
<a name="l00227"></a>00227                         <span class="keywordflow">if</span>($title===null&amp;&amp;$summary===null&amp;&amp;$password===null){
<a name="l00228"></a>00228                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Метод должен изменить заголовок, описание или пароль альбома&quot;</span>,E_ERROR);
<a name="l00229"></a>00229                         }
<a name="l00230"></a>00230                         
<a name="l00231"></a>00231                         <span class="keywordflow">if</span>($token!==null){
<a name="l00232"></a>00232                                 $this-&gt;token = $token;
<a name="l00233"></a>00233                         }
<a name="l00234"></a>00234                         
<a name="l00235"></a>00235                         <span class="keywordflow">if</span>($this-&gt;token===null){
<a name="l00236"></a>00236                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Эта операция доступна только для аутентифицированных пользователей&quot;</span>,E_ERROR);
<a name="l00237"></a>00237                         }
<a name="l00238"></a>00238                         
<a name="l00239"></a>00239                         <span class="keywordflow">if</span>($title!=null){
<a name="l00240"></a>00240                                 $this-&gt;title = (string)$title;
<a name="l00241"></a>00241                         }
<a name="l00242"></a>00242                         <span class="keywordflow">if</span>($summary!=null){
<a name="l00243"></a>00243                                 $this-&gt;summary = (string)$summary;
<a name="l00244"></a>00244                         }
<a name="l00245"></a>00245                         <span class="keywordflow">if</span>($password!=null){
<a name="l00246"></a>00246                                 $this-&gt;password = (string)$password;
<a name="l00247"></a>00247                         }
<a name="l00248"></a>00248                         
<a name="l00249"></a>00249                         $putData = tmpfile();
<a name="l00250"></a>00250                         
<a name="l00251"></a>00251                         <span class="keywordflow">if</span>($this-&gt;<span class="keyword">protected</span>==<span class="keyword">true</span>){
<a name="l00252"></a>00252                                 $protected=<span class="stringliteral">&quot;true&quot;</span>;
<a name="l00253"></a>00253                         }<span class="keywordflow">else</span>{
<a name="l00254"></a>00254                                 $protected=<span class="stringliteral">&quot;false&quot;</span>;
<a name="l00255"></a>00255                         }
<a name="l00256"></a>00256                         
<a name="l00257"></a>00257                         $pass = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00258"></a>00258                         <span class="keywordflow">if</span>($password!==null){
<a name="l00259"></a>00259                                 $pass = <span class="stringliteral">&quot;&lt;f:password&gt;&quot;</span>.$password.<span class="stringliteral">&quot;&lt;/f:password&gt;&quot;</span>;
<a name="l00260"></a>00260                         }
<a name="l00261"></a>00261                         
<a name="l00262"></a>00262                         $message = <span class="stringliteral">&#39;</span>
<a name="l00263"></a>00263 <span class="stringliteral">                        &lt;entry xmlns=&quot;http://www.w3.org/2005/Atom&quot; xmlns:app=&quot;http://www.w3.org/2007/app&quot; xmlns:f=&quot;yandex:fotki&quot;&gt;</span>
<a name="l00264"></a>00264 <span class="stringliteral">                                &lt;id&gt;&#39;</span>.$this-&gt;id.<span class="stringliteral">&#39;&lt;/id&gt;</span>
<a name="l00265"></a>00265 <span class="stringliteral">                                &lt;author&gt;</span>
<a name="l00266"></a>00266 <span class="stringliteral">                                        &lt;name&gt;&#39;</span>.$this-&gt;author.<span class="stringliteral">&#39;&lt;/name&gt;</span>
<a name="l00267"></a>00267 <span class="stringliteral">                                &lt;/author&gt;</span>
<a name="l00268"></a>00268 <span class="stringliteral">                                &lt;title&gt;&#39;</span>.$this-&gt;title.<span class="stringliteral">&#39;&lt;/title&gt;</span>
<a name="l00269"></a>00269 <span class="stringliteral">                                &lt;summary&gt;&#39;</span>.$this-&gt;summary.<span class="stringliteral">&#39;&lt;/summary&gt;</span>
<a name="l00270"></a>00270 <span class="stringliteral">                                &lt;link href=&quot;&#39;</span>.$this-&gt;self_url.<span class="stringliteral">&#39;&quot; rel=&quot;self&quot; /&gt;</span>
<a name="l00271"></a>00271 <span class="stringliteral">                                &lt;link href=&quot;&#39;</span>.$this-&gt;edit_url.<span class="stringliteral">&#39;&quot; rel=&quot;edit&quot; /&gt;</span>
<a name="l00272"></a>00272 <span class="stringliteral">                                &lt;link href=&quot;&#39;</span>.$this-&gt;photos_url.<span class="stringliteral">&#39;&quot; rel=&quot;photos&quot; /&gt;</span>
<a name="l00273"></a>00273 <span class="stringliteral">                                &lt;link href=&quot;&#39;</span>.$this-&gt;alternate_url.<span class="stringliteral">&#39;&quot; rel=&quot;alternate&quot; /&gt;</span>
<a name="l00274"></a>00274 <span class="stringliteral">                                &lt;published&gt;&#39;</span>.$this-&gt;published_date.<span class="stringliteral">&#39;&lt;/published&gt;</span>
<a name="l00275"></a>00275 <span class="stringliteral">                                &lt;app:edited&gt;&#39;</span>.$this-&gt;edited_date.<span class="stringliteral">&#39;&lt;/app:edited&gt;</span>
<a name="l00276"></a>00276 <span class="stringliteral">                                &lt;updated&gt;&#39;</span>.$this-&gt;updated_date.<span class="stringliteral">&#39;&lt;/updated&gt;</span>
<a name="l00277"></a>00277 <span class="stringliteral">                                &lt;f:protected value=&quot;&#39;</span>.$this-&gt;image_count.<span class="stringliteral">&#39;&quot; /&gt;</span>
<a name="l00278"></a>00278 <span class="stringliteral">                                &#39;</span>.$pass.<span class="stringliteral">&#39;</span>
<a name="l00279"></a>00279 <span class="stringliteral">                                &lt;f:image-count value=&quot;&#39;</span>.$protected.<span class="stringliteral">&#39;&quot; /&gt;</span>
<a name="l00280"></a>00280 <span class="stringliteral">                        &lt;/entry&gt;&#39;</span>;
<a name="l00281"></a>00281                         
<a name="l00282"></a>00282                         fwrite($putData, $message);
<a name="l00283"></a>00283                         fseek($putData, 0);
<a name="l00284"></a>00284                         
<a name="l00285"></a>00285                         $curl = curl_init();
<a name="l00286"></a>00286                         curl_setopt($curl, CURLOPT_URL, $this-&gt;edit_url);
<a name="l00287"></a>00287                         curl_setopt($curl, CURLOPT_HEADER, <span class="keyword">false</span>);
<a name="l00288"></a>00288                         curl_setopt($curl, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);
<a name="l00289"></a>00289                         curl_setopt($curl, CURLOPT_PUT, <span class="keyword">true</span>);
<a name="l00290"></a>00290                         curl_setopt($curl, CURLINFO_HEADER_OUT, <span class="keyword">true</span>);
<a name="l00291"></a>00291                         curl_setopt($curl, CURLOPT_INFILE, $putData);
<a name="l00292"></a>00292                         curl_setopt($curl, CURLOPT_INFILESIZE, strlen($message));
<a name="l00293"></a>00293                         curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);
<a name="l00294"></a>00294                         curl_setopt($curl, CURLOPT_HTTPHEADER,array(
<a name="l00295"></a>00295                                 <span class="stringliteral">&#39;Authorization: FimpToken realm=&quot;fotki.yandex.ru&quot;, token=&quot;&#39;</span>.$this-&gt;token.<span class="charliteral">&#39;&quot;&#39;</span>,
<a name="l00296"></a>00296                                 <span class="stringliteral">&#39;Content-Type: application/atom+xml; charset=utf-8; type=entry&#39;</span>,
<a name="l00297"></a>00297                                 <span class="stringliteral">&#39;Expect:&#39;</span>
<a name="l00298"></a>00298                         ));
<a name="l00299"></a>00299                         $response = curl_exec($curl);
<a name="l00300"></a>00300                         <span class="keywordflow">if</span>(curl_getinfo($curl,CURLINFO_HTTP_CODE)!=200){
<a name="l00301"></a>00301                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($response,E_ERROR);
<a name="l00302"></a>00302                         }
<a name="l00303"></a>00303                         
<a name="l00304"></a>00304                         $this-&gt;xml = $this-&gt;delete_ns($response);
<a name="l00305"></a>00305                         fclose($putData); 
<a name="l00306"></a>00306                         curl_close($curl);
<a name="l00307"></a>00307                         $this-&gt;<a class="code" href="classyandex__fotki__album.html#a2aff0844db6d9b56e6ba96123e1dd11c" title="Обновляет данные текущего альбома.">refresh</a>();
<a name="l00308"></a>00308                 }
<a name="l00309"></a>00309                 
<a name="l00311"></a>00311 
<a name="l00314"></a><a class="code" href="classyandex__fotki__album.html#abe8924e3f96f409254cd8a38e2cf0d3e">00314</a>                 <span class="keyword">public</span> function <span class="keyword">delete</span>($token=null){
<a name="l00315"></a>00315                         <span class="keywordflow">if</span>($token!==null){
<a name="l00316"></a>00316                                 $this-&gt;token = $token;
<a name="l00317"></a>00317                         }
<a name="l00318"></a>00318                         <span class="keywordflow">if</span>($this-&gt;token===null){
<a name="l00319"></a>00319                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Эта операция доступна только для аутентифицированных пользователей&quot;</span>,E_ERROR);
<a name="l00320"></a>00320                         }
<a name="l00321"></a>00321                         $curl = curl_init();
<a name="l00322"></a>00322                         curl_setopt($curl, CURLOPT_URL, $this-&gt;edit_url);
<a name="l00323"></a>00323                         curl_setopt($curl, CURLOPT_HEADER, <span class="keyword">false</span>);
<a name="l00324"></a>00324                         curl_setopt($curl, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);
<a name="l00325"></a>00325                         curl_setopt($curl, CURLOPT_CUSTOMREQUEST, <span class="stringliteral">&quot;DELETE&quot;</span>);
<a name="l00326"></a>00326                         curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);
<a name="l00327"></a>00327                         curl_setopt($curl, CURLINFO_HEADER_OUT, <span class="keyword">true</span>);
<a name="l00328"></a>00328                         curl_setopt($curl, CURLOPT_HTTPHEADER,array(
<a name="l00329"></a>00329                                 <span class="stringliteral">&#39;Authorization: FimpToken realm=&quot;fotki.yandex.ru&quot;, token=&quot;&#39;</span>.$this-&gt;token.<span class="charliteral">&#39;&quot;&#39;</span>
<a name="l00330"></a>00330                         ));
<a name="l00331"></a>00331                         $error = curl_exec($curl);
<a name="l00332"></a>00332                         <span class="keywordflow">if</span>(curl_getinfo($curl,CURLINFO_HTTP_CODE)!=204){
<a name="l00333"></a>00333                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($error,E_ERROR);
<a name="l00334"></a>00334                         }
<a name="l00335"></a>00335                         
<a name="l00336"></a>00336                         curl_close($curl);
<a name="l00337"></a>00337                         $this-&gt;dead=<span class="keyword">true</span>;
<a name="l00338"></a>00338                 }
<a name="l00339"></a>00339                 
<a name="l00341"></a>00341 
<a name="l00344"></a>00344                 <span class="keyword">private</span> function reload_xml($xml){
<a name="l00345"></a>00345                         $this-&gt;xml = <span class="stringliteral">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#39;</span>.$xml;
<a name="l00346"></a>00346                         
<a name="l00347"></a>00347                         $sxml = <span class="keyword">new</span> SimpleXMLElement($xml);
<a name="l00348"></a>00348                         $this-&gt;<span class="keywordtype">id</span> = $sxml-&gt;id;
<a name="l00349"></a>00349                         $this-&gt;author = $sxml-&gt;author-&gt;name;
<a name="l00350"></a>00350                         $this-&gt;title = $sxml-&gt;title;
<a name="l00351"></a>00351                         $this-&gt;summary = $sxml-&gt;summary;
<a name="l00352"></a>00352                         $this-&gt;image_count = $sxml-&gt;image_count-&gt;attributes()-&gt;value;
<a name="l00353"></a>00353                         $this-&gt;published_date = $sxml-&gt;published;
<a name="l00354"></a>00354                         $this-&gt;edited_date = $sxml-&gt;edited;
<a name="l00355"></a>00355                         $this-&gt;updated_date = $sxml-&gt;updated;
<a name="l00356"></a>00356                         <span class="keywordflow">if</span>($sxml-&gt;protected-&gt;attributes()-&gt;value==<span class="stringliteral">&quot;false&quot;</span>){
<a name="l00357"></a>00357                                 $this-&gt;<span class="keyword">protected</span> = <span class="keyword">false</span>;
<a name="l00358"></a>00358                         }<span class="keywordflow">else</span>{
<a name="l00359"></a>00359                                 $this-&gt;<span class="keyword">protected</span> = <span class="keyword">true</span>;
<a name="l00360"></a>00360                         }
<a name="l00361"></a>00361                         <span class="keywordflow">foreach</span>($sxml-&gt;link as $link){
<a name="l00362"></a>00362                                 <span class="keywordflow">switch</span>($link-&gt;attributes()-&gt;rel){
<a name="l00363"></a>00363                                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;self&quot;</span>:
<a name="l00364"></a>00364                                                 $this-&gt;self_url = $link-&gt;attributes()-&gt;href;
<a name="l00365"></a>00365                                                 <span class="keywordflow">break</span>;
<a name="l00366"></a>00366                                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;edit&quot;</span>:
<a name="l00367"></a>00367                                                 $this-&gt;edit_url = $link-&gt;attributes()-&gt;href;
<a name="l00368"></a>00368                                                 <span class="keywordflow">break</span>;
<a name="l00369"></a>00369                                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;photos&quot;</span>:
<a name="l00370"></a>00370                                                 $this-&gt;photos_url = $link-&gt;attributes()-&gt;href;
<a name="l00371"></a>00371                                                 <span class="keywordflow">break</span>;
<a name="l00372"></a>00372                                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;ymapsml&quot;</span>:
<a name="l00373"></a>00373                                                 $this-&gt;ymapsml_url = $link-&gt;attributes()-&gt;href;
<a name="l00374"></a>00374                                                 <span class="keywordflow">break</span>;
<a name="l00375"></a>00375                                         <span class="keywordflow">case</span> <span class="stringliteral">&quot;alternate&quot;</span>:
<a name="l00376"></a>00376                                                 $this-&gt;alternate_url = $link-&gt;attributes()-&gt;href;
<a name="l00377"></a>00377                                                 <span class="keywordflow">break</span>;
<a name="l00378"></a>00378                                 }
<a name="l00379"></a>00379                         }
<a name="l00380"></a>00380                 }
<a name="l00381"></a>00381                 
<a name="l00383"></a>00383 
<a name="l00386"></a>00386                 <span class="keyword">private</span> function delete_ns($xml){
<a name="l00387"></a>00387                         $pattern = <span class="stringliteral">&quot;|(&lt;[/]*)[a-z][^:\s&gt;]*:([^:\s&gt;])[\s]*|sui&quot;</span>;
<a name="l00388"></a>00388                         $replacement=<span class="stringliteral">&quot;\\1\\2&quot;</span>;
<a name="l00389"></a>00389                         $xml = preg_replace($pattern,$replacement,$xml);
<a name="l00390"></a>00390                         $pattern = <span class="stringliteral">&quot;|(&lt;[/]*[a-z]+)[-]|sui&quot;</span>;
<a name="l00391"></a>00391                         $replacement=<span class="stringliteral">&quot;\\1_&quot;</span>;
<a name="l00392"></a>00392                         $xml = preg_replace($pattern,$replacement,$xml);
<a name="l00393"></a>00393                         $pattern = <span class="stringliteral">&quot;|xmlns[:a-z]*=\&quot;[^\&quot;]*\&quot;|isu&quot;</span>;
<a name="l00394"></a>00394                         $replacement=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00395"></a>00395                         <span class="keywordflow">return</span> preg_replace($pattern,$replacement,$xml);
<a name="l00396"></a>00396                 }
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398 ?&gt;
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>Указатель</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Структуры данных</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Функции</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Документация по yandex.fotki. Последние изменения: Sat Mar 6 13:33:44 2010. Создано системой&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
